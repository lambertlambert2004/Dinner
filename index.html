<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>School Dinner Menu</title>
<link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/lambertlambert2004/Dinner/main/icon-180.PNG">
<style>
body{font-family:'Segoe UI',system-ui,sans-serif;margin:0;background:#fafafa;color:#333;text-align:center}
header{background:#fff;padding:12px;box-shadow:0 2px 5px rgba(0,0,0,0.1);position:sticky;top:0;z-index:10}
h1{margin:0;font-size:1.4em}
#weekInfo{font-size:0.9em;color:#666;margin-top:4px}
.day{margin:12px auto;padding:14px;border-radius:10px;width:92%;max-width:480px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.08);position:relative}
.day h2{margin-top:0;font-size:1.2em}
.tag{position:absolute;top:-10px;right:-10px;padding:5px 9px;border-radius:6px;font-size:0.8em;color:#fff}
.todayTag{background:#007bff;animation:glow 2s ease-in-out infinite}
.tomorrowTag{background:#ff9800}
@keyframes glow{0%{box-shadow:0 0 6px #007bff}50%{box-shadow:0 0 20px #007bff}100%{box-shadow:0 0 6px #007bff}}
button.pack{margin-top:8px;padding:6px 12px;border:none;border-radius:6px;background:#e0e0e0;color:#333;cursor:pointer}
button.pack.active{background:#4caf50;color:#fff}
#navButtons{position:fixed;bottom:70px;left:0;right:0;text-align:center;z-index:50}
#navButtons button{margin:6px;padding:8px 14px;border:none;border-radius:6px;background:#007bff;color:#fff;font-size:0.9em;cursor:pointer}
</style>
</head>
<body>
<header>
  <h1>School Dinner Menu</h1>
  <div id="weekInfo">Loading...</div>
</header>
<main id="menu"></main>
<div id="navButtons"></div>
<script>
// === MENU DATA (simplified placeholder, replace with full Swansea data) ===
const MENUS = {
  1: {
    Monday:["Beef burger","Vegetarian option","Sides","Dessert"],
    Tuesday:["Pasta bolognese","Veg hotdog","Sides","Dessert"],
    Wednesday:["Roast chicken","Veg roast","Sides","Dessert"],
    Thursday:["Fish fingers","Veg pasta","Sides","Dessert"],
    Friday:["Pizza","Veg wrap","Sides","Dessert"]
  },
  2: {
    Monday:["Breaded chicken steak","Vegetable cheese bake","Accompaniments","Fruit yoghurt pot / fresh fruit"],
    Tuesday:["Pasta bolognese","Veg option","Sides","Dessert"],
    Wednesday:["Roast pork","Veg roast","Sides","Dessert"],
    Thursday:["Curry","Veg curry","Sides","Dessert"],
    Friday:["Fish","Veg wrap","Sides","Dessert"]
  },
  3: {
    Monday:["Chicken curry","Vegetable chilli","Sides","Dessert"],
    Tuesday:["Pasta","Veg hotpot","Sides","Dessert"],
    Wednesday:["Roast beef","Veg roast","Sides","Dessert"],
    Thursday:["Fish pie","Veg pasta","Sides","Dessert"],
    Friday:["Pizza","Veg burger","Sides","Dessert"]
  }
};

// === WEEK CYCLE DATES ===
const weekMap=[
  {week:1,start:"2025-09-01"},
  {week:2,start:"2025-09-08"},
  {week:3,start:"2025-09-15"}
];
function getWeek(date){
  const base=new Date("2025-09-01");
  const diff=Math.floor((date-base)/(7*24*3600*1000));
  return (diff%3+3)%3+1;
}

// === DOM ELEMENTS ===
const menuDiv=document.getElementById("menu");
const weekInfo=document.getElementById("weekInfo");
const navButtons=document.getElementById("navButtons");

let today=new Date();
if(today.getDay()===0){ // Sunday -> prepare next week
  today.setDate(today.getDate()+1);
}
let currentWeek=getWeek(today);
let viewedWeek=currentWeek;

// === RENDER MENU ===
function renderMenu(){
  menuDiv.innerHTML="";
  const week=MENUS[viewedWeek];
  const days=["Monday","Tuesday","Wednesday","Thursday","Friday"];
  days.forEach((day,i)=>{
    const div=document.createElement("div");
    div.className="day";
    const h2=document.createElement("h2");
    h2.textContent=day;
    div.appendChild(h2);
    week[day].forEach(meal=>{
      const p=document.createElement("p");
      p.textContent=meal;
      div.appendChild(p);
    });
    const btn=document.createElement("button");
    btn.className="pack";
    btn.textContent="Select Packed Lunch";
    if(localStorage.getItem(`${viewedWeek}-${day}`)==="1"){
      btn.classList.add("active");
      btn.textContent="Packed Lunch Selected";
    }
    btn.onclick=()=>{
      if(btn.classList.contains("active")){
        btn.classList.remove("active");
        btn.textContent="Select Packed Lunch";
        localStorage.removeItem(`${viewedWeek}-${day}`);
      } else {
        btn.classList.add("active");
        btn.textContent="Packed Lunch Selected";
        localStorage.setItem(`${viewedWeek}-${day}`,"1");
      }
      updateBadge();
    };
    div.appendChild(btn);
    // Tag today/tomorrow
    const checkDate=new Date(today);
    if(viewedWeek===currentWeek){
      const dow=today.getDay();
      if(dow-1===i){ // today
        const tag=document.createElement("div");
        tag.className="tag todayTag";
        tag.textContent="Today";
        div.appendChild(tag);
      }
      if(dow-1===i-1){ // tomorrow
        const tag=document.createElement("div");
        tag.className="tag tomorrowTag";
        tag.textContent="Tomorrow";
        div.appendChild(tag);
      }
    }
    menuDiv.appendChild(div);
  });

  // Week info
  const monday=new Date(today);
  monday.setDate(monday.getDate()-monday.getDay()+1);
  if(viewedWeek!==currentWeek){
    // adjust monday for viewed week
    const diff=(viewedWeek-currentWeek);
    monday.setDate(monday.getDate()+7*diff);
  }
  const formatted=monday.toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"});
  weekInfo.textContent=`Week ${viewedWeek} (Commencing: ${formatted})`;

  // Nav buttons
  navButtons.innerHTML="";
  if(viewedWeek===currentWeek){
    const btn=document.createElement("button");
    btn.textContent=`View Next Week (Week ${(currentWeek%3)+1})`;
    btn.onclick=()=>{viewedWeek=(currentWeek%3)+1;renderMenu()};
    navButtons.appendChild(btn);
  } else {
    const btn=document.createElement("button");
    btn.textContent="Return to Current Week";
    btn.onclick=()=>{viewedWeek=currentWeek;renderMenu()};
    navButtons.appendChild(btn);
  }
}
function updateBadge(){
  if("setAppBadge" in navigator){
    let count=0;
    const days=["Monday","Tuesday","Wednesday","Thursday","Friday"];
    days.forEach(d=>{
      if(localStorage.getItem(`${currentWeek}-${d}`)==="1"){count++}
    });
    navigator.setAppBadge(count).catch(()=>{});
  }
}

renderMenu();
updateBadge();
</script>
</body>
</html>
