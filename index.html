<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>School Dinner Menu</title>
<link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/lambertlambert2004/Dinner/main/icon-180.PNG">
<style>
:root{
  --bg:#f7f7f7;
  --card:#fff;
  --muted:#888;
  --text:#222;
  --accent:#007aff;
  --warm:#ff9500;
  --packed-bg:#fff9d6;
  --other-bg-start:#f0fff6;
  --other-bg-end:#e6fff2;
}
html,body{height:100%;margin:0;padding:0;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--text);}
.app{max-width:820px;margin:0 auto;padding:20px;}
h1{text-align:center;font-weight:800;font-size:1.6rem;margin:0 0 8px;}
h1::after{content:"";display:block;margin:8px auto 0;width:60px;height:2px;background:#e3e4e8;border-radius:2px;}
.meta{text-align:center;margin-bottom:14px;}
.week-label{font-weight:700;font-size:1rem;}
.week-dates{font-size:.9rem;color:var(--muted);margin-top:6px;}
#menuContainer{display:flex;flex-direction:column;gap:14px;position:relative;overflow-y:auto;max-height:70vh;padding-bottom:20px;}
.card{background:var(--card);border-radius:14px;padding:14px;position:relative;opacity:0;transform:translateY(12px) scale(0.98);transition:transform .35s ease,opacity .3s ease, box-shadow .3s ease;}
.card.other-day{background:linear-gradient(145deg,var(--other-bg-start),var(--other-bg-end));}
.card.packed{background:linear-gradient(145deg,var(--packed-bg),#fff4b2);}
.day-name{font-weight:700;font-size:1.05rem;margin-bottom:8px;color:var(--text);}
.meals{white-space:pre-line;font-size:.96rem;color:#333;line-height:1.5;margin-bottom:6px;}
.label{position:absolute;top:12px;right:12px;font-weight:700;font-size:.73rem;color:#fff;padding:6px 9px;border-radius:11px;display:flex;align-items:center;z-index:2;}
.label.today{background:#007aff;animation:glowToday 1.8s ease-in-out infinite alternate;}
.label.tomorrow{background:#ff9500;animation:glowTomorrow 2.8s ease-in-out infinite alternate;}
@keyframes glowToday {0% { box-shadow:0 0 8px 3px rgba(0,122,255,0.45);}50% { box-shadow:0 0 20px 8px rgba(0,122,255,0.6);}100% { box-shadow:0 0 8px 3px rgba(0,122,255,0.45);}}
@keyframes glowTomorrow {0% { box-shadow:0 0 6px 2px rgba(255,149,0,0.4);}50% { box-shadow:0 0 14px 5px rgba(255,149,0,0.5);}100% { box-shadow:0 0 6px 2px rgba(255,149,0,0.4);}}

.toggle{display:inline-block;width:56px;height:32px;position:relative;margin-top:6px;}
.toggle input{opacity:0;width:0;height:0;}
.slider{position:absolute;inset:0;border-radius:32px;background:#ddd;transition:background .22s,border-color .22s;}
.slider::before{content:"";position:absolute;left:4px;bottom:4px;width:24px;height:24px;background:#fff;border-radius:50%;transition:transform .18s, box-shadow .18s;}
input:checked + .slider{background:#34c759;}
input:checked + .slider::before{transform:translateX(24px);}

/* Sticky controls at bottom for iOS */
.controls {
  display:flex;
  justify-content:center;
  gap:12px;
  position: sticky;
  bottom: 16px;
  background: transparent;
  padding-top: 8px;
  padding-bottom: 8px;
  z-index: 10;
}
.week-toggle{background:#007aff;color:#fff;border:none;padding:12px 18px;border-radius:12px;cursor:pointer;font-weight:700;box-shadow:0 8px 22px rgba(0,122,255,0.18);}
.week-toggle:active{transform:scale(.99);background:#0062cc;}
@media(max-width:420px){.app{padding:14px;} h1{font-size:1.35rem;} .week-toggle{padding:10px 14px;}}
</style>
</head>
<body>
<div class="app">
  <h1>School Dinner Menu</h1>

  <div class="meta">
    <div class="week-label" id="weekLabel">Week</div>
    <div class="week-dates" id="weekDates"></div>
  </div>

  <div id="menuContainer" aria-live="polite"></div>

  <div class="controls">
    <button id="toggleWeekBtn" class="week-toggle">View Next Week</button>
    <button id="returnWeekBtn" class="week-toggle" style="display:none;">Return to Current Week</button>
  </div>

  <footer style="margin-top:18px;text-align:center;color:#666;font-size:.88rem;">
    Baked salmon available every Friday as an alternative. Data last updated per Swansea Council 2025.
  </footer>
</div>

<script>
// --- WEEK MAP & MENUS (copied from Swansea Council Primary School Menu 2025) ---
// Source: Swansea Council Primary School Menu 2025.  [oai_citation:1â€¡Swansea](https://www.swansea.gov.uk/article/16171/Primary-school-menu-2025)
const weekMap = [
  { week: 1, start: "2025-09-01" },
  { week: 2, start: "2025-09-08" },
  { week: 3, start: "2025-09-15" }
];

const MENUS = {
  1: {
    Monday: "Oven baked sausages / Vegetarian sausage\nAccompaniments of the day\nHomemade biscuit and peach slices / fresh fruit",
    Tuesday: "BBQ chicken wrap / Cheese and tomato pizza\nAccompaniments of the day\nFruit yoghurt pot / fresh fruit",
    Wednesday: "Cheesy beany jacket / Breaded chicken steak\nAccompaniments of the day\nPancake and sliced fruit / fresh fruit",
    Thursday: "Cottage pie / Tomato pasta bake\nAccompaniments of the day\nCocoa crispy bar / fresh fruit",
    Friday: "Baked fish / Cheese wrap\nAccompaniments of the day\nJam split and fruit wedge / fresh fruit"
  },
  2: {
    Monday: "Breaded chicken steak / Vegetable cheese bake\nAccompaniments of the day\nFruit yoghurt pot / fresh fruit",
    Tuesday: "Pasta bolognaise / Omelette\nAccompaniments of the day\nJelly and mandarins / fresh fruit",
    Wednesday: "Chicken curry / Cheese and tomato pizza\nAccompaniments of the day\nFruit muffin / fresh fruit",
    Thursday: "Roast chicken / Pasta Napolitana\nAccompaniments of the day\nCookie / fresh fruit",
    Friday: "Fish fingers / Cheese wrap\nAccompaniments of the day\nWelsh cake and fruit wedge / fresh fruit"
  },
  3: {
    Monday: "Meatballs / Tomato pasta bake\nAccompaniments of the day\nJam split and fruit wedge / fresh fruit",
    Tuesday: "Chicken curry / Margherita pizza\nAccompaniments of the day\nFruit yoghurt pot / fresh fruit",
    Wednesday: "Cheese and tomato calzone / Breaded chicken steak\nAccompaniments of the day\nJelly and mandarins / fresh fruit",
    Thursday: "Roast turkey / Macaroni cheese\nAccompaniments of the day\nChocolate cookie / fresh fruit",
    Friday: "Baked fish / Cheese wrap\nAccompaniments of the day\nFruit muffin / fresh fruit"
  }
};

// --- State / localStorage ---
let packedLunch = JSON.parse(localStorage.getItem('packedLunch') || '{}');
let currentWeek = null;
let showingWeek = null;

// DOM refs
const menuContainer = document.getElementById('menuContainer');
const weekLabel = document.getElementById('weekLabel');
const weekDates = document.getElementById('weekDates');
const toggleWeekBtn = document.getElementById('toggleWeekBtn');
const returnWeekBtn = document.getElementById('returnWeekBtn');

// Helpers
function parseDate(s){ return new Date(s + 'T00:00:00'); }
function getWeekRange(start){ const s = parseDate(start); const e = new Date(s); e.setDate(s.getDate() + 4); return {start: s, end: e}; }
function getCurrentWeek(){
  const today = new Date();
  const isSunday = today.getDay() === 0;
  for (let i = 0; i < weekMap.length; i++){
    const range = getWeekRange(weekMap[i].start);
    if (today >= range.start && today <= range.end){
      // if it's Sunday, show next week's menu
      return isSunday ? ((i+1) < weekMap.length ? weekMap[i+1].week : weekMap[0].week) : weekMap[i].week;
    }
  }
  // fallback: cycle to first week
  return weekMap[0].week;
}
function formatWeekStart(weekNum){ const w = weekMap.find(x=>x.week===weekNum); return w ? w.start : ''; }
function getPackedCount(week){ return Object.keys(packedLunch[week] || {}).length; }
function updatePackedCountBadge(){ const count = getPackedCount(currentWeek); document.title = count > 0 ? `(${count}) School Dinner Menu` : "School Dinner Menu"; }

// Render logic
function updateReturnButton(){ returnWeekBtn.style.display = (showingWeek === currentWeek) ? 'none' : 'inline-block'; }

function renderMenu(week){
  menuContainer.innerHTML = '';
  weekLabel.textContent = 'Week ' + week;
  weekDates.textContent = 'Week commencing: ' + formatWeekStart(week);

  const weekdays = ["Monday","Tuesday","Wednesday","Thursday","Friday"];
  const startDate = parseDate(formatWeekStart(week));
  const todayObj = new Date();
  const tomorrowObj = new Date(); tomorrowObj.setDate(todayObj.getDate() + 1);

  weekdays.forEach((day, idx) => {
    const card = document.createElement('div'); card.className = 'card';
    const dayName = document.createElement('div'); dayName.className = 'day-name'; dayName.textContent = day;
    const meals = document.createElement('div'); meals.className = 'meals'; meals.textContent = MENUS[week][day] || "No data";

    const dayDate = new Date(startDate); dayDate.setDate(startDate.getDate() + idx);

    const label = document.createElement('span'); label.className = 'label';
    if (todayObj.toDateString() === dayDate.toDateString()){
      label.textContent = 'Today'; label.classList.add('today');
    } else if (tomorrowObj.toDateString() === dayDate.toDateString()){
      label.textContent = 'Tomorrow'; label.classList.add('tomorrow');
    }

    if (label.textContent) meals.appendChild(label);

    // Toggle
    const toggleDiv = document.createElement('div');
    const toggleLabel = document.createElement('label'); toggleLabel.className = 'toggle';
    const input = document.createElement('input'); input.type = 'checkbox';
    input.checked = !!((packedLunch[week] || {})[day]);
    const slider = document.createElement('span'); slider.className = 'slider';
    toggleLabel.appendChild(input); toggleLabel.appendChild(slider); toggleDiv.appendChild(toggleLabel);

    input.addEventListener('change', () => {
      const action = input.checked ? "add packed lunch for" : "remove packed lunch for";
      if (!confirm(`Are you sure you want to ${action} ${day}?`)) { input.checked = !input.checked; return; }

      if (!packedLunch[week]) packedLunch[week] = {};
      if (input.checked) {
        packedLunch[week][day] = true;
        card.classList.add('packed'); card.classList.remove('other-day');
      } else {
        delete packedLunch[week][day];
        card.classList.remove('packed'); card.classList.add('other-day');
      }
      localStorage.setItem('packedLunch', JSON.stringify(packedLunch));
      // Haptic feedback on supporting devices
      if (navigator.vibrate) navigator.vibrate(20);
      // update badge if current week changed
      if (week === currentWeek) updatePackedCountBadge();
    });

    card.appendChild(dayName);
    card.appendChild(meals);
    card.appendChild(toggleDiv);

    if (input.checked) card.classList.add('packed'); else card.classList.add('other-day');

    menuContainer.appendChild(card);
    // entrance animation
    setTimeout(()=>{ card.style.opacity = 1; card.style.transform = "translateY(0) scale(1)"; }, 40);
  });

  updateReturnButton();
}

// Controls
toggleWeekBtn.addEventListener('click', () => {
  showingWeek = (showingWeek % 3) + 1;
  renderMenu(showingWeek);
});
returnWeekBtn.addEventListener('click', () => {
  showingWeek = currentWeek;
  renderMenu(showingWeek);
});

// Auto-update currentWeek (and badge) periodically (in case the user keeps the page open across Sunday)
function startAutoWeekMonitor(){
  setInterval(() => {
    const newWeek = getCurrentWeek();
    if (newWeek !== currentWeek) {
      currentWeek = newWeek;
      updatePackedCountBadge();
      if (showingWeek === currentWeek) renderMenu(currentWeek);
    }
  }, 60000); // every minute
}

// Init
currentWeek = getCurrentWeek();
showingWeek = currentWeek;
renderMenu(showingWeek);
updatePackedCountBadge();
startAutoWeekMonitor();

</script>
</body>
</html>
