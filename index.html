<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>School Dinner Menu</title>
<style>
  :root{
    --bg:#f7f7f7;
    --card:#ffffff;
    --muted:#888;
    --text:#222;
    --accent:#007aff; /* iOS blue */
    --accent-dark:#0062cc;
    --warm:#ff9500;   /* orange for 'tomorrow' */
    --packed-bg:#fff9d6; /* pale packed yellow */
    --other-bg-start:#f0fff6; /* pastel green start */
    --other-bg-end:#e6fff2;   /* pastel green end */
  }

  html,body{height:100%;margin:0;padding:0;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--text);}
  .app { max-width:820px; margin:0 auto; padding:20px; }

  h1{margin:0; text-align:center; font-weight:800; font-size:1.6rem; letter-spacing:0.2px;}
  h1::after{content:"";display:block;margin:8px auto 0;width:60px;height:2px;background:#e3e4e8;border-radius:2px}

  .meta { text-align:center; margin-top:10px; margin-bottom:14px; }
  .week-label { font-weight:700; font-size:1rem; color:var(--text); }
  .week-dates { font-size:.9rem; color:var(--muted); margin-top:6px; }

  /* sticky banner for non-current view */
  .view-banner {
    position:sticky;
    top:84px;
    z-index:50;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin:12px 0;
    background:rgba(255,255,255,0.98);
    padding:10px 14px;
    border-radius:12px;
    box-shadow:0 8px 20px rgba(0,0,0,0.06);
    border:1px solid rgba(0,0,0,0.04);
  }
  .view-banner .text { font-weight:600; color:var(--accent); }
  .view-banner .sub { color:var(--muted); font-weight:500; font-size:.95rem; margin-left:6px; }

  .banner-actions { display:flex; gap:8px; align-items:center; }
  .banner-btn {
    background:var(--accent);
    color:#fff;
    border:none;
    padding:8px 12px;
    border-radius:10px;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 6px 14px rgba(0,122,255,0.18);
  }
  .banner-btn:active{transform:scale(.98); background:var(--accent-dark);}

  /* menu container & cards */
  #menuWrapper { margin-top:8px; }
  #menuContainer { margin-top:8px; display:flex; flex-direction:column; gap:14px; padding-bottom:18px; }
  .card {
    background:var(--card);
    border-radius:14px;
    padding:14px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    position:relative;
    transition:transform .18s ease, box-shadow .18s ease, opacity .28s ease, transform .28s ease;
    touch-action:pan-y;
    opacity:0;
    transform: translateY(8px);
    border: 1px solid rgba(0,0,0,0.04);
  }
  .card:active { transform:scale(1.02) translateY(-2px); box-shadow:0 12px 30px rgba(0,0,0,0.09); }

  /* pastel other-day background */
  .card.other-day {
    background: linear-gradient(145deg, var(--other-bg-start), var(--other-bg-end));
  }

  /* packed pale yellow */
  .card.packed {
    background: linear-gradient(145deg, #fff9d6, #fff4b2);
  }

  .day-name { font-weight:700; font-size:1.05rem; margin-bottom:8px; color:var(--text); }
  .meals { white-space:pre-line; font-size:0.96rem; color:#333; line-height:1.5; margin-bottom:10px; }

  .label {
    position:absolute; top:12px; right:12px;
    font-weight:700; font-size:.73rem; color:#fff; padding:6px 9px; border-radius:11px;
    box-shadow:0 6px 14px rgba(0,0,0,0.08);
  }
  .label.today { background:var(--accent); }
  .label.tomorrow { background:var(--warm); }

  /* Today's card pulse */
  @keyframes glowPulseBlue {
    0% { box-shadow: 0 0 10px 2px rgba(0,122,255,0.12); border-color: rgba(0,122,255,0.08); }
    50% { box-shadow: 0 0 20px 4px rgba(0,122,255,0.16); border-color: rgba(0,122,255,0.12); }
    100% { box-shadow: 0 0 10px 2px rgba(0,122,255,0.12); border-color: rgba(0,122,255,0.08); }
  }
  .today-card {
    border:1px solid rgba(0,122,255,0.12);
    animation: glowPulseBlue 3s ease-in-out infinite;
  }

  /* Tomorrow subtle orange hint */
  @keyframes glowWarm {
    0% { box-shadow: 0 0 0 rgba(255,149,0,0); border-color: rgba(255,149,0,0.06); }
    50% { box-shadow: 0 0 8px rgba(255,149,0,0.06); border-color: rgba(255,149,0,0.09); }
    100% { box-shadow: 0 0 0 rgba(255,149,0,0); border-color: rgba(255,149,0,0.06); }
  }
  .tomorrow-card {
    border:1px solid rgba(255,149,0,0.06);
    animation: glowWarm 4s ease-in-out infinite;
  }

  /* toggle */
  .toggle { display:inline-block; width:56px; height:32px; position:relative; }
  .toggle input{opacity:0;width:0;height:0;}
  .slider{position:absolute;inset:0;border-radius:32px;background:#ddd;transition:background .22s,border-color .22s;}
  .slider::before{content:"";position:absolute;left:4px;bottom:4px;width:24px;height:24px;background:#fff;border-radius:50%;transition:transform .18s, box-shadow .18s;}
  input:checked + .slider{background:#34c759;}
  input:checked + .slider::before{transform:translateX(24px); box-shadow:0 6px 18px rgba(0,0,0,0.12);}

  /* bottom week toggle */
  .controls { display:flex; justify-content:center; margin-top:12px; }
  .week-toggle {
    background:var(--accent);
    color:#fff;
    border:none;
    padding:12px 18px;
    border-radius:12px;
    cursor:pointer;
    font-weight:700;
    box-shadow:0 8px 22px rgba(0,122,255,0.18);
  }
  .week-toggle:active { transform:scale(.99); background:var(--accent-dark); }

  @media (max-width:420px){
    .app{padding:14px;}
    h1{font-size:1.35rem;}
    .banner-btn{padding:8px 10px;}
  }
</style>
</head>
<body>
  <div class="app">
    <h1>School Dinner Menu</h1>

    <div class="meta">
      <div class="week-label" id="weekLabel">Week</div>
      <div class="week-dates" id="weekDates"></div>
    </div>

    <div id="viewBanner" class="view-banner" style="display:none;">
      <div class="text">Viewing Week <span id="bannerWeek">1</span><span class="sub"> — Not current</span></div>
      <div class="banner-actions">
        <button id="bannerBackBtn" class="banner-btn">Back to current week</button>
      </div>
    </div>

    <div id="menuWrapper">
      <div id="menuContainer" aria-live="polite"></div>
    </div>

    <div class="controls">
      <button id="toggleWeekBtn" class="week-toggle" aria-pressed="false">View Next Week</button>
    </div>

    <footer style="margin-top:18px;text-align:center;color:#666;font-size:.88rem;">
      Baked salmon available every Friday as an alternative. Data last updated per Swansea Council 2025.
    </footer>
  </div>

<script>
/* Data & helpers */
const weekMap = [
  { week:1, dates:["2025-09-01","2025-09-22","2025-10-13","2025-11-10","2025-12-01"] },
  { week:2, dates:["2025-09-08","2025-09-29","2025-10-20","2025-11-17","2025-12-08"] },
  { week:3, dates:["2025-09-15","2025-10-06","2025-11-03","2025-11-24","2025-12-15"] }
];

const MENUS = {
  1:{ Monday:"Oven baked sausages / Vegetarian sausage\nAccompaniments\nFruit / Biscuit", Tuesday:"BBQ chicken wrap / Cheese and tomato pizza\nAccompaniments\nFruit yoghurt / Fresh fruit", Wednesday:"Cheesy beany jacket / Breaded chicken steak\nAccompaniments\nPancake and fruit", Thursday:"Cottage pie / Tomato pasta bake\nAccompaniments\nCookie / Fresh fruit", Friday:"Baked fish / Cheese wrap\nAccompaniments\nJam split and fruit wedge" },
  2:{ Monday:"Chicken burger in a bun / Cheese and tomato pizza\nAccompaniments\nFruit or cookie", Tuesday:"Pasta bolognese / Vegetarian hotdog\nAccompaniments\nFruit yoghurt / Fresh fruit", Wednesday:"Roast chicken / Quorn fillet\nAccompaniments\nFruit crumble", Thursday:"Sausage and mash / Vegetable curry\nAccompaniments\nFruit / Jelly", Friday:"Fish fingers / Omelette\nAccompaniments\nChocolate sponge" },
  3:{ Monday:"Beef burger / Veggie burger\nAccompaniments\nFruit or muffin", Tuesday:"Chicken curry / Macaroni cheese\nAccompaniments\nFruit yoghurt / Fresh fruit", Wednesday:"Roast pork / Quorn roast\nAccompaniments\nFruit pie", Thursday:"Lasagne / Vegetable chilli\nAccompaniments\nFruit / Ice cream", Friday:"Battered fish / Cheese wrap\nAccompaniments\nCupcake" }
};

const weekdays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

function formatDateRange(startStr){
  const start = new Date(startStr);
  const end = new Date(start); end.setDate(end.getDate()+4);
  const opts = { day:"numeric", month:"short" };
  return `${start.toLocaleDateString("en-GB",opts)} – ${end.toLocaleDateString("en-GB",opts)}`;
}

/* Week calculation with Sat/Sun rules */
function getAdjustedDateForLabels(){
  // returns adjusted date used for labeling "Today"/"Tomorrow"
  const today = new Date();
  const day = today.getDay();
  const adjusted = new Date(today);
  if(day === 6) adjusted.setDate(adjusted.getDate() - 1); // Saturday -> Friday
  else if(day === 0) adjusted.setDate(adjusted.getDate() + 1); // Sunday -> Monday (next week)
  return adjusted;
}

function getCurrentWeek(){
  const today = new Date();
  const day = today.getDay();
  const adjusted = new Date(today);
  if(day === 6) adjusted.setDate(adjusted.getDate() - 1); // Saturday -> Friday
  else if(day === 0) adjusted.setDate(adjusted.getDate() + 1); // Sunday -> Monday (next week)
  for(const w of weekMap){
    for(const d of w.dates){
      const start = new Date(d);
      const end = new Date(start); end.setDate(end.getDate()+6);
      if(adjusted >= start && adjusted <= end) return w.week;
    }
  }
  return 1;
}

/* App state */
let currentWeek = getCurrentWeek();
let showingWeek = currentWeek;

/* compute label day names according to adjusted date */
const adjustedToday = getAdjustedDateForLabels();
let todayName = weekdays[adjustedToday.getDay()];
let tomorrowAdj = new Date(adjustedToday);
tomorrowAdj.setDate(tomorrowAdj.getDate()+1);
// if tomorrow falls on weekend, move to next school day
if(tomorrowAdj.getDay() === 6) tomorrowAdj.setDate(tomorrowAdj.getDate() + 2);
if(tomorrowAdj.getDay() === 0) tomorrowAdj.setDate(tomorrowAdj.getDate() + 1);
let tomorrowName = weekdays[tomorrowAdj.getDay()];

/* persistence */
let packedLunch = JSON.parse(localStorage.getItem('packedLunch') || '{}');

/* UI elements */
const menuContainer = document.getElementById('menuContainer');
const weekLabelEl = document.getElementById('weekLabel');
const weekDatesEl = document.getElementById('weekDates');
const banner = document.getElementById('viewBanner');
const bannerWeek = document.getElementById('bannerWeek');
const bannerBackBtn = document.getElementById('bannerBackBtn');
const toggleBtn = document.getElementById('toggleWeekBtn');

function updateBanner(){ if(showingWeek !== currentWeek){ banner.style.display = "flex"; bannerWeek.textContent = showingWeek; } else { banner.style.display = "none"; } }

function renderMenu(week){
  weekLabelEl.textContent = `Week ${week}`;
  const wmap = weekMap.find(w=>w.week===week);
  weekDatesEl.textContent = wmap ? formatDateRange(wmap.dates[0]) : "";

  menuContainer.innerHTML = "";
  const days = ["Monday","Tuesday","Wednesday","Thursday","Friday"];
  days.forEach((day, idx)=>{
    const card = document.createElement('div'); card.className = 'card';
    // other-day pastel by default
    card.classList.add('other-day');

    // apply packed background
    if(packedLunch[week] && packedLunch[week][day]) {
      card.classList.remove('other-day');
      card.classList.add('packed');
    }

    // today's pulse only if viewing the actual current week
    if(week === currentWeek && day === todayName) card.classList.add('today-card');

    // tomorrow hint only when viewing current week
    if(week === currentWeek && day === tomorrowName) card.classList.add('tomorrow-card');

    const dayName = document.createElement('div'); dayName.className = 'day-name'; dayName.textContent = day;
    const meals = document.createElement('div'); meals.className = 'meals'; meals.textContent = MENUS[week][day] || "No data";

    const toggle = document.createElement('label'); toggle.className = 'toggle';
    const input = document.createElement('input'); input.type = 'checkbox';
    input.checked = !!(packedLunch[week] && packedLunch[week][day]);
    const slider = document.createElement('span'); slider.className = 'slider';
    toggle.appendChild(input); toggle.appendChild(slider);

    const labelSpan = document.createElement('span');
    if(week === currentWeek){
      if(day === todayName){ labelSpan.textContent = "Today"; labelSpan.className = 'label today'; }
      else if(day === tomorrowName){ labelSpan.textContent = "Tomorrow"; labelSpan.className = 'label tomorrow'; }
    }

    input.addEventListener('change', ()=>{
      packedLunch[week] = packedLunch[week] || {};
      if(input.checked) packedLunch[week][day] = true;
      else delete packedLunch[week][day];
      localStorage.setItem('packedLunch', JSON.stringify(packedLunch));
      if(input.checked){ card.classList.remove('other-day'); card.classList.add('packed'); }
      else { card.classList.remove('packed'); card.classList.add('other-day'); }
    });

    card.appendChild(dayName);
    card.appendChild(meals);
    card.appendChild(toggle);
    if(labelSpan.textContent) card.appendChild(labelSpan);
    menuContainer.appendChild(card);

    // reveal animation
    setTimeout(()=>{ card.style.opacity = 1; card.style.transform = 'translateY(0)'; }, idx*120 + 80);
  });

  // bottom button text
  if(week === currentWeek){
    const nextW = currentWeek % 3 + 1;
    toggleBtn.textContent = `View Next Week (Week ${nextW})`;
    toggleBtn.setAttribute('aria-pressed','false');
  } else {
    toggleBtn.textContent = `Back to Current Week (Week ${currentWeek})`;
    toggleBtn.setAttribute('aria-pressed','true');
  }

  updateBanner();
}

/* Week switching helpers */
function backToCurrent(){ showingWeek = currentWeek; renderMenu(showingWeek); }
function goToNextWeek(){ showingWeek = showingWeek === 3 ? 1 : showingWeek + 1; renderMenu(showingWeek); }
function goToPrevWeek(){ showingWeek = showingWeek === 1 ? 3 : showingWeek - 1; renderMenu(showingWeek); }

/* Buttons */
toggleBtn.addEventListener('click', ()=>{
  if(showingWeek === currentWeek) showingWeek = currentWeek % 3 + 1;
  else showingWeek = currentWeek;
  renderMenu(showingWeek);
});
bannerBackBtn.addEventListener('click', backToCurrent);

/* Swipe gestures */
let touchStartX = 0, touchStartY = 0;
const swipeThreshold = 50, verticalLimit = 120;
const menuWrapper = document.getElementById('menuWrapper');

menuWrapper.addEventListener('touchstart', (e)=>{ if(e.touches && e.touches.length===1){ touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY; } }, {passive:true});
menuWrapper.addEventListener('touchend', (e)=>{
  const touch = e.changedTouches ? e.changedTouches[0] : null;
  if(!touch) return;
  const dx = touch.clientX - touchStartX;
  const dy = touch.clientY - touchStartY;
  if(Math.abs(dy) > verticalLimit) return;
  if(Math.abs(dx) < swipeThreshold) return;
  if(dx < 0) goToNextWeek(); else goToPrevWeek();
}, {passive:true});

/* keyboard */
window.addEventListener('keydown',(e)=>{ if(e.key==='ArrowLeft') goToPrevWeek(); if(e.key==='ArrowRight') goToNextWeek(); if(e.key==='Escape') backToCurrent(); });

/* initial render */
renderMenu(currentWeek);
</script>
</body>
</html>
