<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>School Dinner Menu</title>
<link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/lambertlambert2004/Dinner/refs/heads/main/icon-180.PNG">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="School Dinner Menu">
<meta name="theme-color" content="#f5f7fa">
<link rel="manifest" href="/manifest.json">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=SF+Pro+Display:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --bg-light: #f5f7fa;
    --bg-card-light: rgba(255, 255, 255, 0.9);
    --text-light: #1c2526;
    --packed-light: #fff1cc;
    --accent-blue: #007aff;
    --accent-green: #34c759;
    --accent-orange: #ff9500;
    --accent-red: #ff3b30;
    --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    --border-radius: 16px;
    --font-family: -apple-system, 'SF Pro Display', 'Poppins', sans-serif;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

body.dark-mode {
    --bg-light: #000000;
    --bg-card-light: rgba(30, 30, 30, 0.9);
    --text-light: #ffffff;
    --packed-light: #4a422a;
    --shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

body {
    margin: 0;
    padding: 0 16px 16px;
    font-family: var(--font-family);
    background: var(--bg-light);
    color: var(--text-light);
    transition: var(--transition);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
}

header {
    text-align: center;
    padding: 16px 0;
    background: var(--bg-light);
    position: sticky;
    top: 0;
    z-index: 20;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

h1 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
}

.sub-header {
    font-size: 0.9rem;
    color: #6e6e73;
    margin: 4px 0;
}

body.dark-mode .sub-header {
    color: #8e8e93;
}

#weekInfo {
    font-size: 0.85rem;
    color: #6e6e73;
}

body.dark-mode #weekInfo {
    color: #8e8e93;
}

#menu {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 800px;
    margin: 16px auto 120px;
}

.card {
    position: relative;
    border-radius: var(--border-radius);
    padding: 16px;
    background: var(--bg-card-light);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: var(--shadow);
    transition: var(--transition);
}

.card.packed {
    background: var(--packed-light);
}

.dayTitle {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0 0 8px 0;
}

.menuText {
    white-space: pre-line;
    line-height: 1.5;
    font-size: 0.95rem;
    color: #3c3c43;
}

body.dark-mode .menuText {
    color: #d1d1d6;
}

.dayLabel {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 4px 8px;
    font-weight: 600;
    font-size: 0.75rem;
    color: #fff;
    border-radius: 12px;
    z-index: 3;
}

.dayLabel.today { background: var(--accent-blue); animation: glowBlue 2.6s infinite alternate; }
.dayLabel.tomorrow { background: var(--accent-orange); animation: glowOrange 2.8s infinite alternate; }
.dayLabel.past { background: #8e8e93; }

@keyframes glowBlue {
    0% { box-shadow: 0 0 4px rgba(0, 122, 255, 0.5); }
    50% { box-shadow: 0 0 12px rgba(0, 122, 255, 0.8); }
    100% { box-shadow: 0 0 6px rgba(0, 122, 255, 0.6); }
}

@keyframes glowOrange {
    0% { box-shadow: 0 0 4px rgba(255, 149, 0, 0.5); }
    50% { box-shadow: 0 0 12px rgba(255, 149, 0, 0.8); }
    100% { box-shadow: 0 0 6px rgba(255, 149, 0, 0.6); }
}

.toggle {
    position: absolute;
    right: 12px;
    bottom: 12px;
    width: 51px;
    height: 31px;
}

.toggle input { opacity: 0; width: 0; height: 0; }
.slider {
    position: relative;
    width: 100%;
    height: 100%;
    background: #e5e5ea;
    border-radius: 15px;
    cursor: pointer;
    transition: background 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.slider::before {
    content: '';
    position: absolute;
    left: 2px;
    top: 2px;
    width: 27px;
    height: 27px;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.toggle input:checked + .slider { background: var(--accent-green); }
.toggle input:checked + .slider::before { transform: translateX(20px); }

.toggle:active .slider::before {
    transform: scale(0.95);
}

#weekNav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 600px;
    margin: 16px auto;
    padding: 8px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 14px;
    box-shadow: var(--shadow);
    position: sticky;
    top: 60px;
    z-index: 10;
}

body.dark-mode #weekNav {
    background: rgba(30, 30, 30, 0.9);
}

.nav-btn {
    padding: 8px 12px;
    border: none;
    border-radius: 12px;
    background: var(--accent-blue);
    color: #fff;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    min-width: 44px;
    min-height: 44px;
}

.nav-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.nav-btn:active:not(.disabled) {
    transform: scale(0.95);
}

.nav-btn svg {
    width: 20px;
    height: 20px;
    vertical-align: middle;
}

#weekTitle {
    font-weight: 600;
    font-size: 1rem;
}

#darkModeToggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 44px;
    height: 44px;
    background: var(--bg-card-light);
    border-radius: 50%;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 100;
    transition: var(--transition);
}

body.dark-mode #darkModeToggle {
    background: var(--bg-card-dark);
}

#pullToRefresh {
    position: absolute;
    top: -50px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    font-size: 0.85rem;
    color: #6e6e73;
    opacity: 0;
    transition: opacity 0.3s;
}

#pullToRefresh.visible {
    opacity: 1;
}

:focus {
    outline: 2px solid var(--accent-blue);
    outline-offset: 2px;
}
</style>
</head>
<body>

<div id="pullToRefresh">Pull to refresh...</div>

<header>
  <h1>School Dinner Menu</h1>
  <div class="sub-header">Packed Meals This Week: <span id="packedCount">0</span></div>
  <div id="weekInfo"></div>
</header>

<div id="weekNav">
    <button id="prevWeekBtn" class="nav-btn" aria-label="Previous Week">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg>
    </button>
    <button id="currentWeekBtn" class="nav-btn" aria-label="Current Week">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm1-13h-2v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
    </button>
    <div id="weekTitle"></div>
    <button id="nextWeekBtn" class="nav-btn" aria-label="Next Week">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
    </button>
</div>

<main id="menu"></main>

<div id="darkModeToggle" aria-label="Toggle Dark Mode">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75S6.615 21.75 12 21.75c1.077 0 2.1-.194 3.05-.56A.75.75 0 0 0 15.65 20.5h0a.75.75 0 0 1 .85-.14 9.752 9.752 0 0 0 4.1-6.19c.12-.472-.345-.92-.85-.85a8.25 8.25 0 0 1-5.75 2.19c-3.15 0-5.727-2.585-5.727-5.757 0-3.172 2.577-5.757 5.727-5.757 1.838 0 3.52 1.054 4.58 2.687a.75.75 0 0 0 1.25-.664A9.752 9.752 0 0 0 12 2.25z"/></svg>
</div>

<script>
// --- Menu Data
const MENUS = {
    1: {
        Monday: "Oven baked sausage / Vegetarian sausage\nAccompaniments\nFruit / Biscuit",
        Tuesday: "Oven baked fish / Cheese wrap\nAccompaniments\nJam split and fruit wedge",
        Wednesday: "Chicken curry / Quorn curry\nAccompaniments\nRice, Naan bread and vegetables\nFruit",
        Thursday: "Cottage pie / Macaroni cheese\nAccompaniments\nCookie / Fresh fruit",
        Friday: "Breaded chicken steak / Vegetable hotdog\nAccompaniments\nFruit yoghurt pot / Fresh fruit"
    },
    2: {
        Monday: "Pasta bolognese / Cheese and tomato pizza\nAccompaniments\nFruit / Biscuit",
        Tuesday: "Oven baked fish / Cheese wrap\nAccompaniments\nJam split and fruit wedge",
        Wednesday: "Chicken curry / Quorn curry\nAccompaniments\nRice, Naan bread and vegetables\nFruit",
        Thursday: "Cottage pie / Macaroni cheese\nAccompaniments\nCookie / Fresh fruit",
        Friday: "Breaded chicken steak / Vegetable hotdog\nAccompaniments\nFruit yoghurt pot / Fresh fruit"
    },
    3: {
        Monday: "Oven baked sausage / Vegetarian sausage\nAccompaniments\nFruit / Biscuit",
        Tuesday: "Oven baked fish / Cheese wrap\nAccompaniments\nJam split and fruit wedge",
        Wednesday: "Chicken curry / Quorn curry\nAccompaniments\nRice, Naan bread and vegetables\nFruit",
        Thursday: "Cottage pie / Macaroni cheese\nAccompaniments\nCookie / Fresh fruit",
        Friday: "Breaded chicken steak / Vegetable hotdog\nAccompaniments\nFruit yoghurt pot / Fresh fruit"
    }
};

const weekMap = [
    { week: 1, start: "2025-09-01" },
    { week: 2, start: "2025-09-08" },
    { week: 3, start: "2025-09-15" },
    { week: 1, start: "2025-09-22" },
    { week: 2, start: "2025-09-29" },
    { week: 3, start: "2025-10-06" },
    { week: 1, start: "2025-10-13" },
    { week: 2, start: "2025-10-20" },
    { week: 3, start: "2025-11-03" },
    { week: 1, start: "2025-11-10" },
    { week: 2, start: "2025-11-17" },
    { week: 3, start: "2025-11-24" },
    { week: 1, start: "2025-12-01" },
    { week: 2, start: "2025-12-08" },
    { week: 3, start: "2025-12-15" }
];

// --- State Management
let packedLunch = JSON.parse(localStorage.getItem('packedLunch') || '{}');
let currentWeekIndex = getInitialWeekIndex();

// --- DOM Elements
const menuContainer = document.getElementById('menu');
const weekTitleEl = document.getElementById('weekTitle');
const packedCountEl = document.getElementById('packedCount');
const prevWeekBtn = document.getElementById('prevWeekBtn');
const nextWeekBtn = document.getElementById('nextWeekBtn');
const currentWeekBtn = document.getElementById('currentWeekBtn');
const darkModeToggle = document.getElementById('darkModeToggle');
const pullToRefresh = document.getElementById('pullToRefresh');

// --- Functions
function getInitialWeekIndex() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const todayTimestamp = today.getTime();

    for (let i = weekMap.length - 1; i >= 0; i--) {
        const weekStart = new Date(weekMap[i].start);
        weekStart.setHours(0, 0, 0, 0);
        if (todayTimestamp >= weekStart.getTime()) {
            return i;
        }
    }
    return 0;
}

function renderMenu() {
    menuContainer.innerHTML = '';
    const weekdays = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    const weekInfo = weekMap[currentWeekIndex];

    if (!weekInfo) {
        menuContainer.innerHTML = `<div class="card"><div class="dayTitle">No menu found.</div><div class="menuText">Please check the menu data.</div></div>`;
        return;
    }

    const weekStartDate = new Date(weekInfo.start);
    weekStartDate.setHours(0, 0, 0, 0);

    weekTitleEl.textContent = `Week ${weekInfo.week}`;
    document.getElementById('weekInfo').textContent = `Week commencing ${weekStartDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' })}`;

    weekdays.forEach((day, index) => {
        const card = document.createElement("div");
        card.classList.add("card");
        if (packedLunch[weekInfo.week]?.[day]) card.classList.add("packed");

        const dayDate = new Date(weekStartDate);
        dayDate.setDate(weekStartDate.getDate() + index);
        dayDate.setHours(0, 0, 0, 0);

        const label = document.createElement("span");
        if (dayDate.getTime() === today.getTime()) {
            label.textContent = "Today";
            label.className = "dayLabel today";
            card.appendChild(label);
        } else if (dayDate.getTime() === today.getTime() + 86400000) {
            label.textContent = "Tomorrow";
            label.className = "dayLabel tomorrow";
            card.appendChild(label);
        } else if (dayDate.getTime() < today.getTime()) {
            label.textContent = "Past";
            label.className = "dayLabel past";
            card.appendChild(label);
        }

        const title = document.createElement("div");
        title.className = "dayTitle";
        title.textContent = day;
        card.appendChild(title);

        const menuText = document.createElement("div");
        menuText.className = "menuText";
        menuText.textContent = MENUS[weekInfo.week][day];
        card.appendChild(menuText);

        const toggle = document.createElement("label");
        toggle.className = "toggle";
        const input = document.createElement("input");
        input.type = "checkbox";
        input.checked = !!packedLunch[weekInfo.week]?.[day];
        const slider = document.createElement("span");
        slider.className = "slider";
        toggle.appendChild(input);
        toggle.appendChild(slider);
        card.appendChild(toggle);

        input.addEventListener("change", () => {
            if (!packedLunch[weekInfo.week]) packedLunch[weekInfo.week] = {};
            if (input.checked) packedLunch[weekInfo.week][day] = true;
            else delete packedLunch[weekInfo.week][day];
            localStorage.setItem('packedLunch', JSON.stringify(packedLunch));
            updatePackedCount();
            card.classList.toggle("packed", input.checked);
        });

        menuContainer.appendChild(card);
    });

    updatePackedCount();
    updateNavButtons();
}

function updatePackedCount() {
    const weekInfo = weekMap[currentWeekIndex];
    const count = Object.keys(packedLunch[weekInfo.week] || {}).length;
    packedCountEl.textContent = count;
}

function updateNavButtons() {
    prevWeekBtn.classList.toggle("disabled", currentWeekIndex === 0);
    nextWeekBtn.classList.toggle("disabled", currentWeekIndex === weekMap.length - 1);
}

// --- Pull-to-Refresh Simulation
let startY = 0;
let isPulling = false;

document.addEventListener('touchstart', (e) => {
    if (window.scrollY === 0) {
        startY = e.touches[0].clientY;
        isPulling = true;
    }
});

document.addEventListener('touchmove', (e) => {
    if (isPulling) {
        const currentY = e.touches[0].clientY;
        if (currentY - startY > 50) {
            pullToRefresh.classList.add('visible');
        } else {
            pullToRefresh.classList.remove('visible');
        }
    }
});

document.addEventListener('touchend', () => {
    if (isPulling && pullToRefresh.classList.contains('visible')) {
        renderMenu();
        pullToRefresh.classList.remove('visible');
    }
    isPulling = false;
});

// --- Event Listeners
prevWeekBtn.addEventListener('click', () => {
    if (currentWeekIndex > 0) {
        currentWeekIndex--;
        renderMenu();
    }
});

nextWeekBtn.addEventListener('click', () => {
    if (currentWeekIndex < weekMap.length - 1) {
        currentWeekIndex++;
        renderMenu();
    }
});

currentWeekBtn.addEventListener('click', () => {
    currentWeekIndex = getInitialWeekIndex();
    renderMenu();
});

darkModeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
});

// --- Initial Render
renderMenu();
</script>
</body>
</html>
