<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>School Dinner Menu</title>
<link rel="apple-touch-icon" href="icon-180.png">
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin:0; padding:20px; background:#f7f7f7; color:#333;
  }
  h1 { text-align:center; margin-bottom:5px; font-weight:700; }
  #weekDisplay { text-align:center; font-size:.9rem; color:#666; margin-bottom:20px; }
  .card {
    background:#fff; border-radius:12px; padding:16px; margin-bottom:15px;
    box-shadow:0 2px 6px rgba(0,0,0,0.08); position:relative;
  }
  .day { font-weight:600; font-size:1.1rem; margin-bottom:8px; }
  .menu { white-space:pre-line; font-size:.95rem; line-height:1.4; }
  .toggle { position:absolute; top:16px; right:16px; }
  .toggle input { display:none; }
  .slider {
    position:relative; display:inline-block; width:50px; height:28px;
    background:#ccc; border-radius:28px; cursor:pointer; transition:.4s;
  }
  .slider:before {
    content:""; position:absolute; width:22px; height:22px; left:3px; bottom:3px;
    background:#fff; border-radius:50%; transition:.4s;
  }
  input:checked + .slider { background:#4cd964; }
  input:checked + .slider:before { transform:translateX(22px); }
  .card.other-day { background:#e9f7ef; }
  .card.packed { background:#fff4b2; }
  .label {
    position:absolute; top:10px; left:10px;
    font-size:.7rem; font-weight:600; color:#fff;
    padding:3px 7px; border-radius:5px;
  }
  .label.today { background:#4a90e2; animation:glowBlue 2s infinite alternate; }
  .label.tomorrow { background:#ff6b6b; animation:glowRed 2s infinite alternate; }

  @keyframes glowBlue {
    0% { box-shadow:0 0 6px #4a90e2; transform:scale(1);}
    50%{ box-shadow:0 0 18px #4a90e2; transform:scale(1.05);}
    100%{ box-shadow:0 0 6px #4a90e2; transform:scale(1);}
  }
  @keyframes glowRed {
    0% { box-shadow:0 0 6px #ff6b6b; transform:scale(1);}
    50%{ box-shadow:0 0 18px #ff6b6b; transform:scale(1.05);}
    100%{ box-shadow:0 0 6px #ff6b6b; transform:scale(1);}
  }
  #weekNav { position:fixed; bottom:70px; left:0; width:100%; text-align:center; }
  #weekNav button {
    background:#4a90e2; color:#fff; border:none; border-radius:20px;
    padding:10px 20px; font-size:.9rem; font-weight:600; cursor:pointer;
    box-shadow:0 3px 6px rgba(0,0,0,0.2); margin:5px auto; display:inline-block;
  }
  footer { margin-top:40px; text-align:center; font-size:.8rem; color:#777; }
</style>
</head>
<body>
<h1>School Dinner Menu</h1>
<div id="weekDisplay"></div>
<div id="menu"></div>
<div id="weekNav"></div>
<footer>Baked salmon available every Friday as an alternative. Data sourced from Swansea Council 2025.</footer>

<script>
// WEEK MAP
const weekMap = [
  { week:1, start:"2025-09-01", end:"2025-09-07" },
  { week:2, start:"2025-09-08", end:"2025-09-14" },
  { week:3, start:"2025-09-15", end:"2025-09-21" },
  { week:1, start:"2025-09-22", end:"2025-09-28" },
  { week:2, start:"2025-09-29", end:"2025-10-05" },
  { week:3, start:"2025-10-06", end:"2025-10-12" },
  { week:1, start:"2025-10-13", end:"2025-10-19" },
  { week:2, start:"2025-10-20", end:"2025-10-26" },
  { week:3, start:"2025-11-03", end:"2025-11-09" },
  { week:1, start:"2025-11-10", end:"2025-11-16" },
  { week:2, start:"2025-11-17", end:"2025-11-23" },
  { week:3, start:"2025-11-24", end:"2025-11-30" },
  { week:1, start:"2025-12-01", end:"2025-12-07" },
  { week:2, start:"2025-12-08", end:"2025-12-14" },
  { week:3, start:"2025-12-15", end:"2025-12-21" }
];

// MENUS (official Swansea data)
const MENUS = {
  1: {
    Monday: "Oven baked sausages / Vegetarian sausage\nAccompaniments of the day\nFruit / Biscuit",
    Tuesday: "BBQ chicken wrap / Cheese and tomato pizza\nAccompaniments of the day\nFruit yoghurt / Fresh fruit",
    Wednesday: "Cheesy beany jacket / Breaded chicken steak\nAccompaniments of the day\nPancake and fruit",
    Thursday: "Cottage pie / Tomato pasta bake\nAccompaniments of the day\nCookie / Fresh fruit",
    Friday: "Baked fish / Cheese wrap\nAccompaniments of the day\nJam split and fruit wedge"
  },
  2: {
    Monday: "Breaded chicken steak / Vegetable cheese bake\nAccompaniments of the day\nFruit yoghurt pot / Fresh fruit",
    Tuesday: "Pasta bolognese / Vegetarian hotdog\nAccompaniments of the day\nFruit sponge / Fresh fruit",
    Wednesday: "Roast pork / Quorn fillet\nAccompaniments of the day\nRice pudding / Fresh fruit",
    Thursday: "Chicken curry / Cheese and tomato pizza\nAccompaniments of the day\nIce cream / Fresh fruit",
    Friday: "Fish fingers / Omelette\nAccompaniments of the day\nFruit muffin / Fresh fruit"
  },
  3: {
    Monday: "Roast chicken / Quorn fillet\nAccompaniments of the day\nShortbread / Fresh fruit",
    Tuesday: "Chicken curry / Cheese and tomato pizza\nAccompaniments of the day\nIce cream / Fresh fruit",
    Wednesday: "Roast beef / Vegetarian sausage\nAccompaniments of the day\nChocolate sponge / Fresh fruit",
    Thursday: "Spaghetti bolognese / Tomato pasta bake\nAccompaniments of the day\nFruit jelly / Fresh fruit",
    Friday: "Battered fish / Cheese wrap\nAccompaniments of the day\nJam doughnut / Fresh fruit"
  }
};

const weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

// LOCAL STORAGE
let packed=JSON.parse(localStorage.getItem('packedLunch')||'{}');

// DETERMINE CURRENT WEEK
function getCurrentWeek(date=new Date()){
  let d=new Date(date);
  if(d.getDay()===0) d.setDate(d.getDate()+1); // show next week on Sunday
  for(const w of weekMap){
    if(new Date(d)>=new Date(w.start) && new Date(d)<=new Date(w.end)) return w.week;
  }
  return 1;
}

let viewingWeek=getCurrentWeek();

// RENDER MENU
function renderMenu(){
  const menuDiv=document.getElementById('menu');
  menuDiv.innerHTML='';
  const weekNum=viewingWeek;
  document.getElementById('weekDisplay').textContent=`Week ${weekNum}`;
  
  const todayName=weekdays[new Date().getDay()];
  let tomorrow=new Date(); tomorrow.setDate(tomorrow.getDate()+1);
  if(tomorrow.getDay()===6){tomorrow.setDate(tomorrow.getDate()+2);}
  if(tomorrow.getDay()===0){tomorrow.setDate(tomorrow.getDate()+1);}
  const tomorrowName=weekdays[tomorrow.getDay()];

  ["Monday","Tuesday","Wednesday","Thursday","Friday"].forEach(day=>{
    const card=document.createElement('div');
    card.className='card';
    if(packed[`${weekNum}-${day}`]) card.classList.add('packed');
    else card.classList.add('other-day');

    const dEl=document.createElement('div'); dEl.className='day'; dEl.textContent=day;
    const mEl=document.createElement('div'); mEl.className='menu'; mEl.textContent=MENUS[weekNum][day]||"No menu";

    if(viewingWeek===getCurrentWeek()){
      if(day===todayName){
        const tag=document.createElement('span');
        tag.className='label today'; tag.textContent='Today';
        card.appendChild(tag);
      }
      if(day===tomorrowName){
        const tag=document.createElement('span');
        tag.className='label tomorrow'; tag.textContent='Tomorrow';
        card.appendChild(tag);
      }
    }

    const toggle=document.createElement('label'); toggle.className='toggle';
    const input=document.createElement('input'); input.type='checkbox';
    input.checked=!!packed[`${weekNum}-${day}`];
    const slider=document.createElement('span'); slider.className='slider';
    toggle.appendChild(input); toggle.appendChild(slider);

    input.addEventListener('change',()=>{
      const isChecked=input.checked;
      const action=isChecked?"add packed lunch for":"remove packed lunch for";
      if(!confirm(`Are you sure you want to ${action} ${day}?`)){
        input.checked=!isChecked; return;
      }
      if(isChecked){ card.classList.remove('other-day'); card.classList.add('packed'); packed[`${weekNum}-${day}`]=true;}
      else{ card.classList.remove('packed'); card.classList.add('other-day'); delete packed[`${weekNum}-${day}`];}
      localStorage.setItem('packedLunch',JSON.stringify(packed));
      updateBadge();
    });

    card.appendChild(dEl); card.appendChild(mEl); card.appendChild(toggle);
    menuDiv.appendChild(card);
  });
  renderWeekNav();
}

// WEEK NAVIGATION
function renderWeekNav(){
  const nav=document.getElementById('weekNav');
  nav.innerHTML='';
  const currentWeek=getCurrentWeek();
  if(viewingWeek===currentWeek){
    const btn=document.createElement('button'); btn.textContent=`View Next Week (Week ${currentWeek%3+1})`;
    btn.onclick=()=>{ viewingWeek=currentWeek%3+1; renderMenu(); };
    nav.appendChild(btn);
  } else {
    const btn=document.createElement('button'); btn.textContent='Return to Current Week';
    btn.onclick=()=>{ viewingWeek=currentWeek; renderMenu(); };
    nav.appendChild(btn);
  }
}

// BADGE UPDATE
function updateBadge(){
  const currentWeek=getCurrentWeek();
  let count=0; ["Monday","Tuesday","Wednesday","Thursday","Friday"].forEach(day=>{
    if(packed[`${currentWeek}-${day}`]) count++;
  });
  if('setAppBadge' in navigator){ navigator.setAppBadge(count).catch(()=>{}); }
  else if('webkitSetAppBadge' in navigator){ navigator.webkitSetAppBadge(count).catch(()=>{}); }
}
renderMenu(); updateBadge();
</script>
</body>
</html>
