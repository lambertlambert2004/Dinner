<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>School Dinner Menu</title>
<link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/lambertlambert2004/Dinner/refs/heads/main/icon-180.PNG">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#fafafa">
<link rel="manifest" href="/manifest.json">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=SF+Pro+Display:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --bg-light: #fafafa;
    --bg-card-light: #ffffff;
    --text-light: #333333;
    --packed-light: #ffca28; /* Bright yellow for packed lunch */
    --accent-blue: #0066cc;
    --accent-green: #34c759;
    --accent-orange: #ff9500;
    --accent-red: #ff3b30;
    --toggle-off: #d1d1d6; /* Gray for toggle off */
    --shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    --border-radius: 16px;
    --font-family: -apple-system, 'SF Pro Display', 'Poppins', sans-serif;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

body.dark-mode {
    --bg-light: #1a202c;
    --bg-card-light: #2d3748;
    --text-light: #e2e8f0;
    --packed-light: #5a5231; /* Mustard for dark mode packed */
    --toggle-off: #4b5563; /* Darker gray for dark mode */
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

body {
    margin: 0;
    padding: calc(16px + env(safe-area-inset-top)) 16px 16px;
    font-family: var(--font-family);
    background: var(--bg-light);
    color: var(--text-light);
    box-sizing: border-box;
    min-height: 100vh;
    overflow-y: auto;
    -webkit-font-smoothing: antialiased;
}

header {
    text-align: center;
    padding: 16px 0;
    background: var(--bg-light);
    position: sticky;
    top: env(safe-area-inset-top);
    z-index: 20;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

body:not(.dark-mode) header {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

h1 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
}

.sub-header {
    font-size: 0.9rem;
    color: #666666;
    margin: 4px 0;
}

body.dark-mode .sub-header {
    color: #a0aec0;
}

#weekInfo {
    font-size: 0.85rem;
    color: #666666;
}

body.dark-mode #weekInfo {
    color: #cbd5e0;
}

#menu {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 800px;
    margin: 16px auto 120px;
    position: relative;
    min-height: 100%;
}

#menu.transition-left {
    transform: translateX(-100%);
    opacity: 0;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
}

#menu.transition-right {
    transform: translateX(100%);
    opacity: 0;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
}

.card {
    position: relative;
    border-radius: var(--border-radius);
    padding: 16px;
    background: var(--bg-card-light);
    box-shadow: var(--shadow);
    transition: var(--transition), backdrop-filter 0.3s;
    cursor: pointer;
}

#menu.transition-left .card,
#menu.transition-right .card {
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
}

body:not(.dark-mode) .card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

.card.packed {
    background: var(--packed-light);
}

.dayTitle {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0 0 8px 0;
}

.menuText {
    white-space: pre-line;
    line-height: 1.5;
    font-size: 0.95rem;
    color: #444444;
}

body.dark-mode .menuText {
    color: #cbd5e0;
}

.dayLabel {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 4px 8px;
    font-weight: 600;
    font-size: 0.75rem;
    color: #fff;
    border-radius: 12px;
    z-index: 3;
}

.dayLabel.today { background: var(--accent-blue); animation: glowBlue 2.6s infinite alternate; }
.dayLabel.tomorrow { background: var(--accent-orange); animation: glowOrange 2.8s infinite alternate; }
.dayLabel.past { background: #8e8e93; }

@keyframes glowBlue {
    0% { box-shadow: 0 0 4px rgba(0, 102, 204, 0.5); }
    50% { box-shadow: 0 0 12px rgba(0, 102, 204, 0.8); }
    100% { box-shadow: 0 0 6px rgba(0, 102, 204, 0.6); }
}

@keyframes glowOrange {
    0% { box-shadow: 0 0 4px rgba(255, 149, 0, 0.5); }
    50% { box-shadow: 0 0 12px rgba(255, 149, 0, 0.8); }
    100% { box-shadow: 0 0 6px rgba(255, 149, 0, 0.6); }
}

.toggle {
    position: absolute;
    right: 12px;
    bottom: 12px;
    width: 51px;
    height: 31px;
}

.toggle input { opacity: 0; width: 0; height: 0; }
.slider {
    position: relative;
    width: 100%;
    height: 100%;
    background: var(--toggle-off);
    border-radius: 15px;
    cursor: pointer;
    transition: background 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.slider::before {
    content: '';
    position: absolute;
    left: 2px;
    top: 2px;
    width: 27px;
    height: 27px;
    background: #ffffff;
    border-radius: 50%;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.toggle input:checked + .slider { background: var(--accent-green); }
.toggle input:checked + .slider::before { transform: translateX(20px); }

.toggle:active .slider::before {
    transform: scale(0.95);
}

#weekNav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 600px;
    margin: 16px auto;
    padding: 8px;
    background: var(--bg-card-light);
    border-radius: 14px;
    box-shadow: var(--shadow);
    position: sticky;
    top: calc(60px + env(safe-area-inset-top));
    z-index: 10;
}

body:not(.dark-mode) #weekNav {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

.nav-btn {
    padding: 8px 12px;
    border: none;
    border-radius: 12px;
    background: var(--accent-blue);
    color: #fff;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    min-width: 44px;
    min-height: 44px;
}

.nav-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.nav-btn:active:not(.disabled) {
    transform: scale(0.95);
}

.nav-btn svg {
    width: 20px;
    height: 20px;
    vertical-align: middle;
}

#weekTitle {
    font-weight: 600;
    font-size: 1rem;
}

#darkModeToggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 44px;
    height: 44px;
    background: var(--bg-card-light);
    border-radius: 50%;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 100;
    transition: var(--transition);
}

#pullToRefresh {
    position: absolute;
    top: calc(-50px + env(safe-area-inset-top));
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    font-size: 0.85rem;
    color: #666666;
    opacity: 0;
    transition: opacity 0.3s;
}

body.dark-mode #pullToRefresh {
    color: #a0aec0;
}

#pullToRefresh.visible {
    opacity: 1;
}

#modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

#modalContent {
    background: var(--bg-card-light);
    border-radius: var(--border-radius);
    padding: 20px;
    max-width: 90%;
    max-height: 80%;
    overflow-y: auto;
    box-shadow: var(--shadow);
    transform: scale(0.7);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#modal.show #modalContent {
    transform: scale(1);
}

#modal h2 {
    margin: 0 0 12px;
    font-size: 1.2rem;
    font-weight: 600;
}

#modal p {
    margin: 0 0 12px;
    font-size: 0.95rem;
    color: #444444;
}

body.dark-mode #modal p {
    color: #cbd5e0;
}

#modal button {
    background: var(--accent-blue);
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
}

#modal button:active {
    transform: scale(0.95);
}

.toast {
    position: absolute;
    bottom: 60px;
    right: 16px;
    background: var(--bg-card-light);
    color: var(--text-light);
    padding: 8px 16px;
    border-radius: 12px;
    box-shadow: var(--shadow);
    font-size: 0.85rem;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.3s, transform 0.3s;
    z-index: 100;
}

.toast.show {
    opacity: 1;
    transform: translateY(0);
}

:focus {
    outline: 2px solid var(--accent-blue);
    outline-offset: 2px;
}
</style>
</head>
<body>

<div id="pullToRefresh">Pull to refresh...</div>

<header>
  <h1>School Dinner Menu</h1>
  <div class="sub-header">Packed Meals This Week: <span id="packedCount">0</span></div>
  <div id="weekInfo"></div>
</header>

<div id="weekNav">
    <button id="prevWeekBtn" class="nav-btn" aria-label="Previous Week">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/></svg>
    </button>
    <button id="currentWeekBtn" class="nav-btn" aria-label="Current Week">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm1-13h-2v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
    </button>
    <div id="weekTitle"></div>
    <button id="nextWeekBtn" class="nav-btn" aria-label="Next Week">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
    </button>
</div>

<main id="menu"></main>

<div id="modal">
    <div id="modalContent">
        <h2 id="modalTitle"></h2>
        <p id="modalDescription"></p>
        <button id="modalClose">Close</button>
    </div>
</div>

<div id="darkModeToggle" aria-label="Toggle Dark Mode">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75S6.615 21.75 12 21.75c1.077 0 2.1-.194 3.05-.56A.75.75 0 0 0 15.65 20.5h0a.75.75 0 0 1 .85-.14 9.752 9.752 0 0 0 4.1-6.19c.12-.472-.345-.92-.85-.85a8.25 8.25 0 0 1-5.75 2.19c-3.15 0-5.727-2.585-5.727-5.757 0-3.172 2.577-5.757 5.727-5.757 1.838 0 3.52 1.054 4.58 2.687a.75.75 0 0 0 1.25-.664A9.752 9.752 0 0 0 12 2.25z"/></svg>
</div>

<script>
// --- Menu Data
const MENUS = {
    1: {
        Monday: "Oven baked sausage / Vegetarian sausage\nAccompaniments\nFruit / Biscuit",
        Tuesday: "Oven baked fish / Cheese wrap\nAccompaniments\nJam split and fruit wedge",
        Wednesday: "Chicken curry / Quorn curry\nAccompaniments\nRice, Naan bread and vegetables\nFruit",
        Thursday: "Cottage pie / Macaroni cheese\nAccompaniments\nCookie / Fresh fruit",
        Friday: "Breaded chicken steak / Vegetable hotdog\nAccompaniments\nFruit yoghurt pot / Fresh fruit"
    },
    2: {
        Monday: "Pasta bolognese / Cheese and tomato pizza\nAccompaniments\nFruit / Biscuit",
        Tuesday: "Oven baked fish / Cheese wrap\nAccompaniments\nJam split and fruit wedge",
        Wednesday: "Chicken curry / Quorn curry\nAccompaniments\nRice, Naan bread and vegetables\nFruit",
        Thursday: "Cottage pie / Macaroni cheese\nAccompaniments\nCookie / Fresh fruit",
        Friday: "Breaded chicken steak / Vegetable hotdog\nAccompaniments\nFruit yoghurt pot / Fresh fruit"
    },
    3: {
        Monday: "Oven baked sausage / Vegetarian sausage\nAccompaniments\nFruit / Biscuit",
        Tuesday: "Oven baked fish / Cheese wrap\nAccompaniments\nJam split and fruit wedge",
        Wednesday: "Chicken curry / Quorn curry\nAccompaniments\nRice, Naan bread and vegetables\nFruit",
        Thursday: "Cottage pie / Macaroni cheese\nAccompaniments\nCookie / Fresh fruit",
        Friday: "Breaded chicken steak / Vegetable hotdog\nAccompaniments\nFruit yoghurt pot / Fresh fruit"
    }
};

const MENU_DETAILS = {
    1: {
        Monday: { description: "Sausage or vegetarian sausage with mashed potatoes and gravy. Includes fruit or a biscuit." },
        Tuesday: { description: "Freshly baked fish or cheese wrap with salad. Served with a jam split and fruit wedge." },
        Wednesday: { description: "Mild chicken or Quorn curry with rice, naan, and mixed vegetables. Fruit included." },
        Thursday: { description: "Traditional cottage pie or macaroni cheese with greens. Comes with a cookie or fruit." },
        Friday: { description: "Breaded chicken steak or veggie hotdog with fries. Includes fruit yoghurt or fresh fruit." }
    },
    2: {
        Monday: { description: "Hearty pasta bolognese or cheese and tomato pizza with salad. Fruit or biscuit included." },
        Tuesday: { description: "Freshly baked fish or cheese wrap with salad. Served with a jam split and fruit wedge." },
        Wednesday: { description: "Mild chicken or Quorn curry with rice, naan, and mixed vegetables. Fruit included." },
        Thursday: { description: "Traditional cottage pie or macaroni cheese with greens. Comes with a cookie or fruit." },
        Friday: { description: "Breaded chicken steak or veggie hotdog with fries. Includes fruit yoghurt or fresh fruit." }
    },
    3: {
        Monday: { description: "Sausage or vegetarian sausage with mashed potatoes and gravy. Includes fruit or a biscuit." },
        Tuesday: { description: "Freshly baked fish or cheese wrap with salad. Served with a jam split and fruit wedge." },
        Wednesday: { description: "Mild chicken or Quorn curry with rice, naan, and mixed vegetables. Fruit included." },
        Thursday: { description: "Traditional cottage pie or macaroni cheese with greens. Comes with a cookie or fruit." },
        Friday: { description: "Breaded chicken steak or veggie hotdog with fries. Includes fruit yoghurt or fresh fruit." }
    }
};

const weekMap = [
    { week: 1, start: "2025-09-01" },
    { week: 2, start: "2025-09-08" },
    { week: 3, start: "2025-09-15" },
    { week: 1, start: "2025-09-22" },
    { week: 2, start: "2025-09-29" },
    { week: 3, start: "2025-10-06" },
    { week: 1, start: "2025-10-13" },
    { week: 2, start: "2025-10-20" },
    { week: 3, start: "2025-11-03" },
    { week: 1, start: "2025-11-10" },
    { week: 2, start: "2025-11-17" },
    { week: 3, start: "2025-11-24" },
    { week: 1, start: "2025-12-01" },
    { week: 2, start: "2025-12-08" },
    { week: 3, start: "2025-12-15" }
];

// --- State Management
let packedLunch = JSON.parse(localStorage.getItem('packedLunch') || '{}');
let currentWeekIndex = getInitialWeekIndex();
let weekCache = {};
const isDarkMode = localStorage.getItem('darkMode') === 'true';
if (isDarkMode) document.body.classList.add('dark-mode');

// --- DOM Elements
const menuContainer = document.getElementById('menu');
const weekTitleEl = document.getElementById('weekTitle');
const packedCountEl = document.getElementById('packedCount');
const prevWeekBtn = document.getElementById('prevWeekBtn');
const nextWeekBtn = document.getElementById('nextWeekBtn');
const currentWeekBtn = document.getElementById('currentWeekBtn');
const darkModeToggle = document.getElementById('darkModeToggle');
const pullToRefresh = document.getElementById('pullToRefresh');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalDescription = document.getElementById('modalDescription');
const modalClose = document.getElementById('modalClose');

// --- Functions
function getInitialWeekIndex() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const todayTimestamp = today.getTime();
    const isSunday = today.getDay() === 0;

    let index = 0;
    for (let i = weekMap.length - 1; i >= 0; i--) {
        const weekStart = new Date(weekMap[i].start);
        weekStart.setHours(0, 0, 0, 0);
        if (todayTimestamp >= weekStart.getTime()) {
            index = i;
            break;
        }
    }

    if (isSunday && index < weekMap.length - 1) {
        index++;
    }

    return index;
}

function generateWeekContent(index) {
    if (!weekMap[index]) return '<div class="card"><div class="dayTitle">No menu found.</div><div class="menuText">Please check the menu data.</div></div>';

    const weekdays = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const weekInfo = weekMap[index];
    const weekStartDate = new Date(weekInfo.start);
    weekStartDate.setHours(0, 0, 0, 0);

    let html = '';
    weekdays.forEach((day, i) => {
        const dayDate = new Date(weekStartDate);
        dayDate.setDate(weekStartDate.getDate() + i);
        dayDate.setHours(0, 0, 0, 0);

        const isPacked = !!packedLunch[weekInfo.week]?.[day];
        let label = '';
        if (dayDate.getTime() === today.getTime()) {
            label = '<span class="dayLabel today">Today</span>';
        } else if (dayDate.getTime() === today.getTime() + 86400000) {
            label = '<span class="dayLabel tomorrow">Tomorrow</span>';
        } else if (dayDate.getTime() < today.getTime()) {
            label = '<span class="dayLabel past">Past</span>';
        }

        html += `
            <div class="card${isPacked ? ' packed' : ''}" data-day="${day}" data-week="${weekInfo.week}">
                ${label}
                <div class="dayTitle">${day}</div>
                <div class="menuText">${MENUS[weekInfo.week][day]}</div>
                <label class="toggle">
                    <input type="checkbox"${isPacked ? ' checked' : ''}>
                    <span class="slider"></span>
                </label>
            </div>
        `;
    });

    return html;
}

function preloadWeeks() {
    weekCache[currentWeekIndex] = generateWeekContent(currentWeekIndex);
    if (currentWeekIndex > 0) {
        weekCache[currentWeekIndex - 1] = generateWeekContent(currentWeekIndex - 1);
    }
    if (currentWeekIndex < weekMap.length - 1) {
        weekCache[currentWeekIndex + 1] = generateWeekContent(currentWeekIndex + 1);
    }
}

function renderMenu(direction = null) {
    if (!weekMap[currentWeekIndex]) return;

    if (direction) {
        menuContainer.classList.add(direction === 'next' ? 'transition-left' : 'transition-right');
        requestAnimationFrame(() => {
            setTimeout(() => {
                menuContainer.innerHTML = weekCache[currentWeekIndex] || generateWeekContent(currentWeekIndex);
                menuContainer.classList.remove('transition-left', 'transition-right');
                attachCardListeners();
                updateDisplay();
                preloadWeeks();
            }, 300);
        });
    } else {
        menuContainer.innerHTML = weekCache[currentWeekIndex] || generateWeekContent(currentWeekIndex);
        attachCardListeners();
        updateDisplay();
        preloadWeeks();
    }
}

function attachCardListeners() {
    document.querySelectorAll('.card').forEach(card => {
        const input = card.querySelector('input');
        const day = card.dataset.day;
        const week = card.dataset.week;

        input.addEventListener('change', () => {
            if (!packedLunch[week]) packedLunch[week] = {};
            if (input.checked) {
                packedLunch[week][day] = true;
                showToast(`Packed lunch added for ${day}`, card);
            } else {
                delete packedLunch[week][day];
                showToast(`Packed lunch removed for ${day}`, card);
            }
            localStorage.setItem('packedLunch', JSON.stringify(packedLunch));
            updatePackedCount();
            card.classList.toggle('packed', input.checked);
            preloadWeeks(); // Update cache for packed lunch changes
        });

        card.addEventListener('click', (e) => {
            if (e.target.closest('.toggle')) return;
            modalTitle.textContent = `${day} - Week ${week}`;
            modalDescription.textContent = MENU_DETAILS[week][day].description;
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('show'), 10);
        });
    });
}

function showToast(message, card) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    card.appendChild(toast);
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, 2000);
}

function updateDisplay() {
    const weekInfo = weekMap[currentWeekIndex];
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const isSunday = today.getDay() === 0;

    if (!weekInfo) {
        menuContainer.innerHTML = '<div class="card"><div class="dayTitle">No menu found.</div><div class="menuText">Please check the menu data.</div></div>';
        return;
    }

    const weekStartDate = new Date(weekInfo.start);
    weekStartDate.setHours(0, 0, 0, 0);

    weekTitleEl.textContent = `Week ${weekInfo.week}`;
    document.getElementById('weekInfo').textContent = `Week commencing ${weekStartDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' })}`;
    currentWeekBtn.querySelector('svg').style.display = isSunday ? 'none' : 'inline';
    currentWeekBtn.textContent = isSunday ? 'Next Week' : '';
    currentWeekBtn.style.padding = isSunday ? '8px 16px' : '8px 12px';

    updatePackedCount();
    updateNavButtons();
}

function updatePackedCount() {
    const weekInfo = weekMap[currentWeekIndex];
    const count = Object.keys(packedLunch[weekInfo.week] || {}).length;
    packedCountEl.textContent = count;
}

function updateNavButtons() {
    prevWeekBtn.classList.toggle('disabled', currentWeekIndex === 0);
    nextWeekBtn.classList.toggle('disabled', currentWeekIndex === weekMap.length - 1);
}

// --- Pull-to-Refresh Simulation
let startY = 0;
let isPulling = false;

document.addEventListener('touchstart', (e) => {
    if (window.scrollY === 0) {
        startY = e.touches[0].clientY;
        isPulling = true;
    }
});

document.addEventListener('touchmove', (e) => {
    if (isPulling) {
        const currentY = e.touches[0].clientY;
        if (currentY - startY > 50) {
            pullToRefresh.classList.add('visible');
        } else {
            pullToRefresh.classList.remove('visible');
        }
    }
});

document.addEventListener('touchend', () => {
    if (isPulling && pullToRefresh.classList.contains('visible')) {
        renderMenu();
        pullToRefresh.classList.remove('visible');
    }
    isPulling = false;
});

// --- Event Listeners
prevWeekBtn.addEventListener('click', () => {
    if (currentWeekIndex > 0) {
        currentWeekIndex--;
        renderMenu('prev');
    }
});

nextWeekBtn.addEventListener('click', () => {
    if (currentWeekIndex < weekMap.length - 1) {
        currentWeekIndex++;
        renderMenu('next');
    }
});

currentWeekBtn.addEventListener('click', () => {
    currentWeekIndex = getInitialWeekIndex();
    renderMenu();
});

darkModeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
});

modalClose.addEventListener('click', () => {
    modal.classList.remove('show');
    setTimeout(() => modal.style.display = 'none', 300);
});

// --- Notification Placeholder
function requestNotificationPermission() {
    if ('Notification' in window && Notification.permission !== 'denied') {
        Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
                console.log('Notifications enabled. Add logic to schedule packed lunch reminders.');
            }
        });
    }
}

// --- Initial Render
requestNotificationPermission();
preloadWeeks();
renderMenu();
</script>
</body>
</html>
