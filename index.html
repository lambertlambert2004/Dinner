<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>School Dinner Menu</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  margin:0; padding:20px; background:#f0f2f5;
}
h1 { text-align:center; margin-bottom:5px; font-weight:700; color:#333; }
#weekNumber { text-align:center; font-size:.9rem; color:#666; margin-bottom:15px; }
.card {
  background:#dfffe0;
  border-radius:12px;
  box-shadow:0 2px 10px rgba(0,0,0,0.08);
  padding:15px; margin-bottom:15px; position:relative; transition: transform 0.2s, background 0.3s;
}
.card.packed { background:#fff4b2; }
.day-name { font-weight:600; font-size:1.15rem; margin-bottom:8px; color:#333; }
.meals { white-space:pre-line; line-height:1.4; color:#444; }
.label {
  position:absolute; top:10px; right:10px; font-size:0.75rem; font-weight:bold;
  color:#fff; padding:3px 6px; border-radius:6px; z-index:2;
}
.label.today { background:#4a90e2; animation: glow 2s infinite alternate; }
.label.tomorrow { background:#ff9500; }
@keyframes glow { 0%{box-shadow:0 0 5px #4a90e2}100%{box-shadow:0 0 20px #4a90e2} }
.toggle { position:relative; display:inline-block; width:50px; height:28px; margin-top:10px; }
.toggle input { opacity:0; width:0; height:0; }
.slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background-color:#ccc; transition:.4s; border-radius:28px; }
.slider:before { position:absolute; content:""; height:22px; width:22px; left:3px; bottom:3px; background-color:white; transition:.4s; border-radius:50%; }
input:checked + .slider { background-color:#4cd964; }
input:checked + .slider:before { transform:translateX(22px); }
#controls { text-align:center; margin-top:10px; }
#toggleWeekBtn, #returnWeekBtn {
  background:#4a90e2; color:#fff; border:none; padding:8px 14px; border-radius:8px;
  margin:4px; cursor:pointer; font-weight:bold;
}
#returnWeekBtn { display:none; background:#ff6b6b; }
/* Floating viewing week indicator with pulse animation */
#viewingWeekIndicator {
  position:fixed; bottom:60px; left:50%; transform:translateX(-50%);
  background:#ff6b6b; color:#fff; padding:8px 14px; border-radius:12px; font-weight:bold;
  box-shadow:0 2px 6px rgba(0,0,0,0.2); display:none; z-index:1000;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0% { transform:translateX(-50%) scale(1); opacity:0.9; }
  50% { transform:translateX(-50%) scale(1.05); opacity:1; }
  100% { transform:translateX(-50%) scale(1); opacity:0.9; }
}
/* Packed meals badge */
#packedBadge {
  position:fixed; top:15px; right:15px; background:#4cd964; color:#fff;
  font-weight:bold; padding:6px 10px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.2); z-index:1000;
  font-size:0.85rem;
}
</style>
</head>
<body>
<h1>School Dinner Menu</h1>
<div id="weekNumber"></div>
<div id="menuContainer"></div>
<div id="controls">
  <button id="toggleWeekBtn">View Next Week</button>
  <button id="returnWeekBtn">Return to Current Week</button>
</div>
<div id="viewingWeekIndicator"></div>
<div id="packedBadge"></div>

<script>
// Swansea Council 2025 verified menus
const MENUS = {
  1: { Monday:"Oven baked sausages / Vegetarian sausage\nAccompaniments of the day\nHomemade biscuit and peach slices / fresh fruit",
       Tuesday:"BBQ chicken wrap / Cheese and tomato pizza\nAccompaniments of the day\nFruit yoghurt pot / fresh fruit",
       Wednesday:"Cheesy beany jacket / Breaded chicken steak\nAccompaniments of the day\nPancake and sliced fruit / fresh fruit",
       Thursday:"Cottage pie / Tomato pasta bake\nAccompaniments of the day\nCocoa crispy bar / fresh fruit",
       Friday:"Baked fish / Cheese wrap\nAccompaniments of the day\nJam split and fruit wedge / fresh fruit" },
  2: { Monday:"Breaded chicken steak / Vegetable cheese bake\nAccompaniments of the day\nFruit yoghurt pot / fresh fruit",
       Tuesday:"Pasta bolognese / Omelette\nAccompaniments of the day\nJelly and mandarins / fresh fruit",
       Wednesday:"Chicken curry / Cheese and tomato pizza\nAccompaniments of the day\nFruit muffin / fresh fruit",
       Thursday:"Roast chicken / Pasta Napolitana\nAccompaniments of the day\nCookie / fresh fruit",
       Friday:"Fish fingers / Cheese wrap\nAccompaniments of the day\nWelsh cake and fruit wedge / fresh fruit" },
  3: { Monday:"Meatballs / Tomato pasta bake\nAccompaniments of the day\nJam split and fruit wedge / fresh fruit",
       Tuesday:"Chicken curry / Margherita pizza\nAccompaniments of the day\nFruit yoghurt pot / fresh fruit",
       Wednesday:"Cheese and tomato calzone / Breaded chicken steak\nAccompaniments of the day\nJelly and mandarins / fresh fruit",
       Thursday:"Roast turkey / Macaroni cheese\nAccompaniments of the day\nChocolate cookie / fresh fruit",
       Friday:"Baked fish / Cheese wrap\nAccompaniments of the day\nFruit muffin / fresh fruit" }
};

const weekMap = [
  {week:1,start:"2025-09-01",end:"2025-09-05"},
  {week:2,start:"2025-09-08",end:"2025-09-12"},
  {week:3,start:"2025-09-15",end:"2025-09-19"}
];

const weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

function getWeekNum(date){
  let d=new Date(date);
  for(let i=weekMap.length-1;i>=0;i--){
    if(d >= new Date(weekMap[i].start) && d <= new Date(weekMap[i].end)) return weekMap[i].week;
  }
  return 1;
}
function getCurrentAndTomorrow(){
  let t=new Date();
  let todayName=weekdays[t.getDay()];
  let tm=new Date(t);
  tm.setDate(tm.getDate()+1);
  if(tm.getDay()===6) tm.setDate(tm.getDate()+2);
  if(tm.getDay()===0) tm.setDate(tm.getDate()+1);
  return {today:todayName,tomorrow:weekdays[tm.getDay()]};
}

let currentWeek=getWeekNum(new Date());
let viewedWeek=currentWeek;
const menuContainer=document.getElementById("menuContainer");
const viewingWeekIndicator=document.getElementById("viewingWeekIndicator");
const packedBadge=document.getElementById("packedBadge");

function renderWeek(w){
  menuContainer.innerHTML="";
  const {today:todayName,tomorrow:tomName}=getCurrentAndTomorrow();
  const packed=JSON.parse(localStorage.getItem("packedLunch")||"{}");

  ["Monday","Tuesday","Wednesday","Thursday","Friday"].forEach(day=>{
    let card=document.createElement("div");
    card.classList.add("card");
    if(packed[w]&&packed[w][day]) card.classList.add("packed");

    let dn=document.createElement("div"); dn.className="day-name"; dn.textContent=day;

    let meals=document.createElement("div"); meals.className="meals"; meals.textContent=MENUS[w][day]||"No data";

    if(w===currentWeek){
      if(day===todayName){ let tLabel=document.createElement("span"); tLabel.className="label today"; tLabel.textContent="Today"; meals.appendChild(tLabel); }
      if(day===tomName){ let tLabel=document.createElement("span"); tLabel.className="label tomorrow"; tLabel.textContent="Tomorrow"; meals.appendChild(tLabel); }
    }

    let tdToggle=document.createElement("label"); tdToggle.className="toggle";
    let input=document.createElement("input"); input.type="checkbox"; input.checked=!!(packed[w]&&packed[w][day]);
    let slider=document.createElement("span"); slider.className="slider"; tdToggle.appendChild(input); tdToggle.appendChild(slider);

    input.addEventListener("change",()=>{
      const action=input.checked?"add":"remove";
      if(!confirm(`Are you sure you want to ${action} packed lunch for ${day}?`)){ input.checked=!input.checked; return; }
      if(!packed[w]) packed[w]={};
      if(input.checked){ packed[w][day]=true; card.classList.add("packed"); } 
      else { delete packed[w][day]; card.classList.remove("packed"); }
      localStorage.setItem("packedLunch",JSON.stringify(packed));
      updateBadge();
    });

    card.appendChild(dn); card.appendChild(meals); card.appendChild(tdToggle);
    menuContainer.appendChild(card);
  });

  document.getElementById("weekNumber").textContent=`Week ${w} (Week commencing: ${weekMap[w-1].start})`;
  updateBadge();
  document.getElementById("returnWeekBtn").style.display=(viewedWeek===currentWeek)?"none":"inline-block";

  if(viewedWeek!==currentWeek){
    viewingWeekIndicator.style.display="block";
    viewingWeekIndicator.textContent=`Viewing Week ${viewedWeek} â€” Not Current`;
  } else { viewingWeekIndicator.style.display="none"; }
}

// Packed meals badge update
function updateBadge(){
  const packed=JSON.parse(localStorage.getItem("packedLunch")||"{}");
  let count=0; if(packed[viewedWeek]) count=Object.keys(packed[viewedWeek]).length;
  packedBadge.textContent=`Packed Meals: ${count}`;
  if('setAppBadge' in navigator) navigator.setAppBadge(count).catch(()=>{});
}

// Auto update week on Sunday
setInterval(()=>{
  const newWeek=getWeekNum(new Date());
  if(newWeek!==currentWeek){
    currentWeek=newWeek;
    if(viewedWeek===currentWeek) renderWeek(currentWeek);
  }
},60000);

document.getElementById("toggleWeekBtn").addEventListener("click",()=>{ viewedWeek=(viewedWeek%3)+1; renderWeek(viewedWeek); });
document.getElementById("returnWeekBtn").addEventListener("click",()=>{ viewedWeek=currentWeek; renderWeek(currentWeek); });

renderWeek(currentWeek);
</script>
</body>
</html>
